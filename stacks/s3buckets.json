{
    "AWSTemplateFormatVersion" : "2010-09-09",
  
    "Description" : "Cloud Formation Template for Site and Log Buckets for StaticWebSite on S3",
  
    "Parameters" : {
        "HostedZoneName" : {
          "Type" : "String",
          "Description" : "The DNS name of an existing Amazon Route 53 hosted zone"
        },
        "HostName" : {
          "Type" : "String",
          "Description" : "The hostname that will be appended to HostZone to create the Site",
          "AllowedPattern" : "(?!-)[a-zA-Z0-9-.]{1,63}(?<!-)",
          "ConstraintDescription" : "must be a valid host name."
        },

        "RetainBucketsOnDeletion" : {
            "Type" : "String",
            "AllowedValues": ["YES", "NO"],
            "Description" : "Must retain WebSite and Log Bucket on Stack Deletion?",
            "Default": "NO"
        }
    },

    "Conditions" : {

      "RetainBuckets" : {"Fn::Equals" : [{"Ref" : "RetainBucketsOnDeletion"}, "YES"]}

    },
  
    "Mappings" : {
      "Region2S3WebsiteSuffix": {
        "us-east-1"      : { "Suffix": ".s3-website-us-east-1.amazonaws.com" },
        "us-west-1"      : { "Suffix": ".s3-website-us-west-1.amazonaws.com" },
        "us-west-2"      : { "Suffix": ".s3-website-us-west-2.amazonaws.com" },
        "eu-west-1"      : { "Suffix": ".s3-website-eu-west-1.amazonaws.com" },
        "eu-west-2"      : { "Suffix": ".s3-website-eu-west-2.amazonaws.com" },
        "eu-west-3"      : { "Suffix": ".s3-website-eu-west-3.amazonaws.com" },
        "ap-northeast-1" : { "Suffix": ".s3-website-ap-northeast-1.amazonaws.com" },
        "ap-northeast-2" : { "Suffix": ".s3-website-ap-northeast-2.amazonaws.com" },
        "ap-northeast-3" : { "Suffix": ".s3-website-ap-northeast-3.amazonaws.com" },
        "ap-southeast-1" : { "Suffix": ".s3-website-ap-southeast-1.amazonaws.com" },
        "ap-southeast-2" : { "Suffix": ".s3-website-ap-southeast-2.amazonaws.com" },
        "ap-south-1"     : { "Suffix": ".s3-website-ap-south-1.amazonaws.com" },
        "us-east-2"      : { "Suffix": ".s3-website-us-east-2.amazonaws.com" },
        "ca-central-1"   : { "Suffix": ".s3-website-ca-central-1.amazonaws.com" },
        "sa-east-1"      : { "Suffix": ".s3-website-sa-east-1.amazonaws.com" },
        "cn-north-1"     : { "Suffix": ".s3-website.cn-north-1.amazonaws.com.cn" },
        "cn-northwest-1" : { "Suffix": ".s3-website.cn-northwest-1.amazonaws.com.cn" },
        "eu-central-1"   : { "Suffix": ".s3-website-eu-central-1.amazonaws.com" }
      }
  
    },
  
    "Resources" : {
  
      "S3BucketForWebsiteLog" : {
        "Type" : "AWS::S3::Bucket",
        "Properties" : {
          "BucketName" : { "Fn::Join" : [ "", [ "", "logs.", { "Ref" : "HostName" }, ".", { "Ref" : "HostedZoneName" } ] ] },
          "AccessControl" : "LogDeliveryWrite"
        }
      },
  
      "S3BucketForWebsiteContent" : {
        "Type" : "AWS::S3::Bucket",
        "DependsOn": ["S3BucketForWebsiteLog"],
        "Properties" : {
          "BucketName" : { "Fn::Join" : [ "", [ "", { "Ref" : "HostName" }, ".", { "Ref" : "HostedZoneName" } ] ] },
          "AccessControl" : "PublicRead",
          "LoggingConfiguration" : { "DestinationBucketName" : { "Fn::Join" : [ "", [ "", "logs.", { "Ref" : "HostName" }, ".", { "Ref" : "HostedZoneName" } ] ] }, "LogFilePrefix" : "bucket/"},
          "WebsiteConfiguration" : {"IndexDocument" : "index.html", "ErrorDocument" : "error.html"}
        }
      }

    },
  
    "Outputs" : {
      
      "LogBucket" : {
        "Value" : { "Fn::Join" : [ "", [ "logs.", { "Ref" : "HostName" }, ".", { "Ref" : "HostedZoneName" }, ".s3.amazonaws.com" ] ] },
        "Description" : "S3 Bucket Name for logging",
        "Export" : {"Name" : {"Fn::Sub": "${AWS::StackName}-LogBucket" }}
      },

      "SiteBucket" : {
        "Value" : { "Fn::Join" : ["", [ { "Ref" : "HostName" }, ".", { "Ref" : "HostedZoneName" }, ".s3.amazonaws.com"]]},
        "Description" : "S3 Bucket configured to host content as a website",
        "Export" : {"Name" : {"Fn::Sub": "${AWS::StackName}-SiteBucket" }}
      },

      "SiteBucketName" : {
        "Value" : { "Fn::Join" : [ "", [ "", { "Ref" : "HostName" }, ".", { "Ref" : "HostedZoneName" } ] ] },
        "Description" : "S3 Bucket configured to host content as a website",
        "Export" : {"Name" : {"Fn::Sub": "${AWS::StackName}-SiteBucketName" }}
      },

      "LogBucketName" : {
        "Value" : { "Fn::Join" : [ "", [ "logs.", { "Ref" : "HostName" }, ".", { "Ref" : "HostedZoneName" } ] ] },
        "Description" : "S3 Bucket Name for logging",
        "Export" : {"Name" : {"Fn::Sub": "${AWS::StackName}-LogBucketName" }}
      }

    }
  }
  